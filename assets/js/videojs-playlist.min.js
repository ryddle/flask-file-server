/*! @name videojs-playlist @version 6.0.0-1 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("video.js")):"function"==typeof define&&define.amd?define(["exports","video.js"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).videojsPlaylist={},t.videojs)}(this,(function(t,e){"use strict";function s(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=s(e);function r(){return r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},r.apply(this,arguments)}const l=(t,e)=>"number"==typeof e&&e>=0&&e<t.length;class n extends i.default.EventTarget{static from(t,e){const s=new n(e);return s.setItems(t),s}constructor(t={}){super(),this.sanitizePlaylistItem_=t=>{if(!t||"object"!=typeof t||!Array.isArray(t.sources))return this.onError_("Invalid playlist item: Must be an object with a `sources` array."),null;const e=t.sources.filter((t=>t&&"object"==typeof t&&"string"==typeof t.src&&"string"==typeof t.type));if(0===e.length)return this.onError_("Invalid playlist item: No valid sources were found."),null;e.length<t.sources.length&&this.onWarn_("Some invalid playlist item sources were disregarded.");const{poster:s="",textTracks:i=[]}=t;return r({},t,{poster:s,textTracks:i,sources:e})},this.items_=[],this.currentIndex_=null,this.repeat_=!1,this.onError_=t.onError||(()=>{}),this.onWarn_=t.onWarn||(()=>{})}setItems(t){if(!Array.isArray(t))return this.onError_("The playlist must be an array."),[...this.items_];const e=t.map(this.sanitizePlaylistItem_).filter((t=>null!==t));return 0===e.length?(this.onError_("Cannot set the playlist as none of the provided playlist items were valid."),[...this.items_]):(this.items_=e,this.trigger("playlistchange"),[...this.items_])}getItems(){return[...this.items_]}reset(){this.currentIndex_=null,this.items_=[],this.trigger("playlistchange")}enableRepeat(){this.repeat_=!0}disableRepeat(){this.repeat_=!1}isRepeatEnabled(){return this.repeat_}setCurrentIndex(t){l(this.items_,t)?this.currentIndex_=t:this.onError_("Cannot set index that is out of bounds.")}getCurrentItem(){return this.items_[this.currentIndex_]}getCurrentIndex(){return null===this.currentIndex_?-1:this.currentIndex_}getLastIndex(){return this.items_.length?this.items_.length-1:-1}getNextIndex(){if(null===this.currentIndex_)return-1;const t=(this.currentIndex_+1)%this.items_.length;return this.repeat_||0!==t?t:-1}getPreviousIndex(){if(null===this.currentIndex_)return-1;const t=(this.currentIndex_-1+this.items_.length)%this.items_.length;return this.repeat_||t!==this.items_.length-1?t:-1}add(t,e){if(!Array.isArray(t)){if("object"!=typeof t||null===t)return this.onError_("Provided items must be an object or an array of objects."),[];t=[t]}const s="number"!=typeof e||e<0||e>this.items_.length?this.items_.length:e,i=this.items_.slice(0,s),r=this.items_.slice(s),l=t.map(this.sanitizePlaylistItem_).filter((t=>null!==t));return 0===l.length?(this.onError_("Cannot add items to the playlist as none were valid."),[]):(this.items_=[...i,...l,...r],s<=this.currentIndex_&&(this.currentIndex_+=l.length),this.trigger({type:"playlistadd",count:l.length,index:s}),[...l])}remove(t,e=1){if(!l(this.items_,t))return this.onError_("Index is out of bounds."),[];if("number"!=typeof e||e<0)return this.onError_("Invalid count for removal."),[];const s=Math.min(e,this.items_.length-t),i=this.items_.splice(t,s);return this.adjustCurrentIndexAfterRemoval_(t,s),this.trigger({type:"playlistremove",count:s,index:t}),[...i]}sort(t){if(!this.items_.length||"function"!=typeof t)return;const e=this.getCurrentItem();this.items_.sort(t),this.currentIndex_=this.items_.indexOf(e),this.trigger("playlistsorted")}reverse(){this.items_.length&&(this.items_.reverse(),this.currentIndex_=this.items_.length-1-this.currentIndex_,this.trigger("playlistsorted"))}shuffle({rest:t=!0}={}){const e=t?this.currentIndex_+1:0,s=this.items_.slice(e);if(s.length<=1)return;const i=this.getCurrentItem();(t=>{for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}})(s),t?this.items_.splice(e,s.length,...s):this.items_=s,this.currentIndex_=this.items_.indexOf(i),this.trigger("playlistsorted")}adjustCurrentIndexAfterRemoval_(t,e){this.currentIndex_<t||(this.currentIndex_>=t+e?this.currentIndex_-=e:this.currentIndex_=null)}}class a{constructor(t,e){this.startTimeout_=()=>{this.clearTimeout_(),null!==this.delay_&&(this.player_.one("play",this.clearTimeout_),this.timeoutId_=setTimeout((()=>{this.advanceCallback_(),this.clearTimeout_()}),1e3*this.delay_))},this.clearTimeout_=()=>{this.timeoutId_&&(clearTimeout(this.timeoutId_),this.timeoutId_=null,this.player_.off("play",this.clearTimeout_))},this.player_=t,this.advanceCallback_=e,this.delay_=null,this.timeoutId_=null}setDelay(t){this.fullReset(),"number"!=typeof t||t<0||!isFinite(t)||(this.delay_=t,this.player_.on("ended",this.startTimeout_))}getDelay(){return this.delay_}fullReset(){this.clearTimeout_(),this.player_.off("ended",this.startTimeout_),this.delay_=null}}const o=i.default.getPlugin("plugin"),h=i.default.log.createLogger("videojs-playlist");class u extends o{static createPlaylistFrom(t){return n.from(t,{onError:h.error,onWarn:h.warn})}constructor(t,e){super(t),this.playNext_=()=>{const t=!!this.player.options_.audioPosterMode;this.loadNextItem({loadPoster:t})&&this.player.play()},this.handleSourceChange_=()=>{const t=this.player.currentSrc();this.isSourceInPlaylist_(t)||this.handleNonPlaylistSource_()},this.playlist_=null,this.autoAdvance_=null}loadPlaylist(t){this.unloadPlaylist(),this.playlist_=t,this.autoAdvance_=new a(this.player,this.playNext_),this.setupEventForwarding_(),this.player.on("loadstart",this.handleSourceChange_)}unloadPlaylist(){this.playlist_&&(this.playlist_.reset(),this.cleanupEventForwarding_()),this.autoAdvance_&&this.autoAdvance_.fullReset(),this.player.off("loadstart",this.handleSourceChange_)}getPlaylist(){return this.playlist_}setAutoadvanceDelay(t){this.autoAdvance_&&this.autoAdvance_.setDelay(t)}getAutoadvanceDelay(){return this.autoAdvance_?this.autoAdvance_.getDelay():null}loadPlaylistItem(t,{loadPoster:e=!0}={}){const s=this.playlist_.getItems();return l(s,t)?(this.loadItem_(s[t],{loadPoster:e}),this.playlist_.setCurrentIndex(t),!0):(h.error("Index is out of bounds."),!1)}loadFirstItem(){return this.loadPlaylistItem(0)}loadLastItem(){const t=this.playlist_.getLastIndex();return this.loadPlaylistItem(t)}loadNextItem({loadPoster:t=!0}={}){const e=this.playlist_.getNextIndex();return-1!==e&&this.loadPlaylistItem(e,{loadPoster:t})}loadPreviousItem(){const t=this.playlist_.getPreviousIndex();return-1!==t&&this.loadPlaylistItem(t)}loadItem_(t,{loadPoster:e=!0}={}){this.player.trigger("beforeplaylistitem",t),this.clearExistingItemTextTracks_(),this.player.poster(e?t.poster:""),this.player.src(t.sources),this.player.ready((()=>{this.addItemTextTracks_(t),this.player.trigger("playlistitem",t)}))}setupEventForwarding_(){["playlistchange","playlistadd","playlistremove","playlistsorted"].forEach((t=>this.playlist_.on(t,(t=>this.player.trigger(t)))))}cleanupEventForwarding_(){["playlistchange","playlistadd","playlistremove","playlistsorted"].forEach((t=>this.playlist_.off(t,this.handlePlaylistEvent_)))}clearExistingItemTextTracks_(){const t=this.player.remoteTextTracks();let e=t&&t.length||0;for(;e--;)this.player.removeRemoteTextTrack(t[e])}addItemTextTracks_(t){t.textTracks.forEach(this.player.addRemoteTextTrack.bind(this.player))}isSourceInPlaylist_(t){return this.playlist_.getItems().some((e=>e.sources.some((e=>e.src===t))))}handleNonPlaylistSource_(){this.autoAdvance_.fullReset(),this.playlist_.setCurrentIndex(null)}}u.VERSION="6.0.0-1",i.default.registerPlugin("playlistPlugin",u),t.AutoAdvance=a,t.Playlist=n,t.default=u,Object.defineProperty(t,"__esModule",{value:!0})}));
